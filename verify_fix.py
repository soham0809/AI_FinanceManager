#!/usr/bin/env python3
"""
Verify that the transaction_type error is fixed
"""
import requests
import json

BASE_URL = "http://localhost:8000"

def test_all_endpoints():
    """Test all the endpoints that were failing"""
    
    print("üîç Testing Fixed Endpoints")
    print("=" * 40)
    
    # Test 1: Chatbot Query
    print("1. Testing Chatbot Query...")
    try:
        response = requests.post(f"{BASE_URL}/v1/chatbot/query-public", 
                               json={"query": "hii"})
        if response.status_code == 200:
            print("   ‚úÖ Chatbot working!")
        else:
            print(f"   ‚ùå Chatbot error: {response.status_code}")
            print(f"      {response.text}")
    except Exception as e:
        print(f"   ‚ùå Chatbot exception: {e}")
    
    # Test 2: Quick Insights
    print("\n2. Testing Quick Insights...")
    try:
        response = requests.post(f"{BASE_URL}/v1/chatbot/quick-insights-public", json={})
        if response.status_code == 200:
            print("   ‚úÖ Quick Insights working!")
        else:
            print(f"   ‚ùå Quick Insights error: {response.status_code}")
            print(f"      {response.text}")
    except Exception as e:
        print(f"   ‚ùå Quick Insights exception: {e}")
    
    # Test 3: Transactions
    print("\n3. Testing Transactions...")
    try:
        response = requests.get(f"{BASE_URL}/v1/transactions-public")
        if response.status_code == 200:
            data = response.json()
            print(f"   ‚úÖ Transactions working! Found {len(data)} transactions")
        else:
            print(f"   ‚ùå Transactions error: {response.status_code}")
    except Exception as e:
        print(f"   ‚ùå Transactions exception: {e}")
    
    # Test 4: SMS Parsing
    print("\n4. Testing SMS Parsing...")
    try:
        test_sms = "Spent Rs 250.00 at SWIGGY on 21-10-2025 using UPI"
        response = requests.post(f"{BASE_URL}/v1/parse-sms-public", 
                               json={"sms_text": test_sms})
        if response.status_code == 200:
            print("   ‚úÖ SMS Parsing working!")
        else:
            print(f"   ‚ùå SMS Parsing error: {response.status_code}")
            print(f"      {response.text}")
    except Exception as e:
        print(f"   ‚ùå SMS Parsing exception: {e}")
    
    print("\n" + "=" * 40)
    print("üéâ All critical endpoints tested!")
    print("\nüì± Your Flutter app should now work without the")
    print("   'Transaction' object has no attribute 'transaction_type' error!")

if __name__ == "__main__":
    test_all_endpoints()
